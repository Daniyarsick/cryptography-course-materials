# Алгоритм без передачи ключей ;
# Аннануров Даниил 3 курс

with(numtheory):
with(RandomTools):
# Генерируем большое простое число
p:= nextprime(Generate(integer(range=10^8..10^10)));
# Выбираем первый ключ пользователя A
a := prevprime(p);
# Выбираем второй ключ пользователя B
b := prevprime(a);
# Вычисляем обратные элементы
alpha := a^(-1) mod phi(p);
beta := b^(-1) mod phi(p);
# Генерируем случайное сообщение
m := Generate(integer(range=1..p));
# A шифрует сообщение своим ключом
m1 := m&^a mod p;
# B шифрует результат своим ключом
m2 := m1&^b mod p;
# A расшифровывает своим обратным ключом
m3 := m2&^alpha mod p;
# B получает исходное сообщение
m4 := m3&^beta mod p;