# Аннануров Даниил 3 курс
# Атака с помощью выбранного шифртекста-1

with(numtheory):
with(RandomTools):

# Генерация параметров RSA
p:= nextprime(Generate(integer(range=3..10^10)));
q:= nextprime(Generate(integer(range=3..10^10)));
n:=p*q;
e:= prevprime(phi(n));
# Вычисление секретного ключа (в реальности недоступен атакующему)
d:= e&^(-1) mod phi(n);

# Исходное сообщение и его шифрование
m:=12345;					# исходное сообщение
c:=m&^e mod n;				# зашифрованное сообщение (перехвачено)

# Криптоанализ: атака с выбранным шифртекстом
r:=4444;					# случайное число, выбранное атакующим
x:=r&^e mod n;				# шифрование случайного числа
y:=x*c mod n;				# модификация перехваченного шифртекста

# Дешифрование модифицированного шифртекста (oracle)
t:=r&^(-1) mod n;			# обратный элемент к r
u:=y&^d mod n;				# результат дешифрования (получен от oracle)

# Восстановление исходного сообщения
m1:= t*u mod n;

# Проверка корректности атаки
m - m1;