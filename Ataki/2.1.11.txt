# Аннануров Даниил 3 курс
# Атака с помощью выбранного шифртекста-3

with(numtheory):
with(RandomTools):

# Генерация параметров RSA
p:= nextprime(Generate(integer(range=3..10^10)));
q:= nextprime(Generate(integer(range=3..10^10)));
n:=p*q;
e:= prevprime(phi(n));
# Вычисление секретного ключа (в реальности недоступен атакующему)
d:= e&^(-1) mod phi(n);

# Криптоанализ: третья атака с выбранным шифртекстом
m3:=12345;					# целевое составное сообщение
s:= m3&^d mod n;			# дешифрование целевого сообщения (oracle)
m2:= 4444;					# выбранный атакующим множитель
m1:= m3/m2 mod n;			# вычисление первого сомножителя

# Получение дешифровок составляющих через oracle
s1:=m1&^d mod n;			# дешифрование первого сомножителя
s2:=m2&^d mod n;			# дешифрование второго сомножителя

# Восстановление через мультипликативное свойство RSA
s3:= s1*s2 mod n;			# произведение дешифровок должно равняться s

# Проверка корректности атаки
s - s3;