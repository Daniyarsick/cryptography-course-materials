# Аннануров Даниил 3 курс
# Атака с использованием общего модуля

with(numtheory):
with(RandomTools):

# Генерация параметров RSA
p:= nextprime(Generate(integer(range=3..10^10)));
q:= nextprime(p);
# Общий модуль для двух разных ключей
N:=p*q;

# Генерация двух разных открытых экспонент
e1:= nextprime(Generate(integer(range=3..p)));
e2:=nextprime(Generate(integer(range=3..p)));

# Шифрование одного сообщения двумя разными ключами
m:= 12345; 							# сообщение
c1:= m&^(e1) mod N;					# шифртекст с первым ключом
c2:=m&^(e2) mod N;					# шифртекст со вторым ключом

# Криптоанализ: решение через расширенный алгоритм Евклида
r:= 'r'; s:='s'; _Z1:=1:
ex:=isolve(e1*r+e2*s=1): assign(ex);r;s; 		# решение диофантового уравнения

# Восстановление исходного сообщения
m2:= (c1&^(-1))&^(-r)*c2&^s mod N; 

# Проверка корректности восстановления
m2-m;