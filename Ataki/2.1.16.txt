# Аннануров Даниил 3 курс
# Атака с использованием "слепой" подписи

with(numtheory):
with(RandomTools):

# Генерация параметров RSA для системы подписи
p:= nextprime(Generate(integer(range=3..10^10)));
q:= nextprime(Generate(integer(range=3..10^10)));
n:=p*q;
e:= prevprime(phi(n));				# открытый ключ для проверки подписи
d:= e&^(-1) mod phi(n);				# секретный ключ для создания подписи

# Целевое сообщение и его легальная подпись
m:=12345;							# сообщение, которое нужно подписать
s:=m&^d mod n;						# легальная подпись сообщения

# Криптоанализ: атака через слепую подпись
r:=4444;							# случайный "ослепляющий" множитель
m1:=r&^e*m mod n;					# ослепленное сообщение
s1:=m1&^d mod n;					# подпись ослепленного сообщения (от oracle)

# Восстановление подписи исходного сообщения
s2:= r&^(-1)*s1 mod n;				# разослепление подписи

# Проверка успешности атаки
s2-s;