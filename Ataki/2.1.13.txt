# Аннануров Даниил 3 курс
# Атака на передачу связанных сообщений с малым открытым ключом

with(numtheory):
with(RandomTools):

# Генерация параметров RSA
p:= nextprime(Generate(integer(range=3..10^10)));
q:= nextprime(Generate(integer(range=3..10^10)));
n:=p*q;
# Использование малой открытой экспоненты (уязвимость)
e:= 3;

# Генерация связанных сообщений
m1:=Generate(integer(range=1..100000));	# первое сообщение
a:=Generate(integer(range=3..10));			# коэффициент связи
b:=Generate(integer(range=3..10^5));		# смещение
m2:= a*m1 + b mod n;					# второе сообщение (линейно связанное)

# Шифрование связанных сообщений
c1:=m1 &^e mod n;						# шифртекст первого сообщения
c2:=m2 &^e mod n;						# шифртекст второго сообщения

# Криптоанализ: восстановление через связь сообщений
m3:= (b * (c2 + 2*a^e*c1 - b^e)) / (a * (c2 - a^e*c1 + 2*b^e));

# Проверка корректности восстановления
m3-m1;