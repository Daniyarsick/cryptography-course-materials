# Атака с помощью выбранного шифртекста-4
# Сороколит Никита Алексеевич 3 курс

with(numtheory):
with(RandomTools):

# Генерация параметров RSA
p:= nextprime(Generate(integer(range=3..10^10)));
q:= nextprime(Generate(integer(range=3..10^10)));
n:=p*q;
e:= prevprime(phi(n));
# Вычисление секретного ключа (в реальности недоступен атакующему)
d:= e&^(-1) mod phi(n);

# Исходное сообщение и его шифрование
m:=12345;					# исходное сообщение
c:=m&^e mod n;				# зашифрованное сообщение (перехвачено)

# Криптоанализ: четвертая атака с выбранным шифртекстом
r:=4444;					# случайное число, выбранное атакующим
M1:=r&^e*c mod n;			# модификация шифртекста
C1:= M1&^d mod n;			# дешифрование модифицированного текста (oracle)

# Восстановление исходного сообщения
M:= r&^(-1)*c&^(d)*r mod n;

# Проверка корректности атаки
M - m;