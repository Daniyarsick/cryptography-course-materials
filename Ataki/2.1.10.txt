# Аннануров Даниил 3 курс
# Атака с помощью выбранного шифртекста-2

with(numtheory):
with(RandomTools):

# Генерация параметров RSA
p:= nextprime(Generate(integer(range=3..10^10)));
q:= nextprime(Generate(integer(range=3..10^10)));
n:=p*q;
e:= prevprime(phi(n));
# Вычисление секретного ключа (в реальности недоступен атакующему)
d:= e&^(-1) mod phi(n);

# Параметры для атаки
m:=12345;					# целевое сообщение
x:=4444;					# вспомогательное число
y:=x&^e mod n;				# шифрование вспомогательного числа

# Криптоанализ: вторая атака с выбранным шифртекстом
N:= 4421;					# выбранное атакующим число
s:=N&^d mod n;				# дешифрование выбранного числа (oracle)
M:=y*N;					# формирование составного шифртекста
z:=M&^d mod n;				# дешифрование составного шифртекста (oracle)

# Восстановление результата через мультипликативное свойство RSA
s1:= x&^(-1)*z mod n;

# Проверка корректности атаки
s - s1;